import tkinter as tk
import subprocess
import os
import webbrowser
import psutil

# Paths
START_SCRIPT = "start-simulator.bat"
STOP_SCRIPT = "stop-simulator.bat"
LOG_FILE = os.path.join("backend", "logs", "simulation_report.txt")

# --- Functions ---
def start_simulator():
    subprocess.Popen(START_SCRIPT, shell=True)

def stop_simulator():
    subprocess.Popen(STOP_SCRIPT, shell=True)

def check_status():
    flask_running = any("python.exe" in p.name().lower() for p in psutil.process_iter())
    react_running = any("node.exe" in p.name().lower() for p in psutil.process_iter())
    
    status = ""
    status += "🟢 Flask (backend): RUNNING\n" if flask_running else "🔴 Flask (backend): OFF\n"
    status += "🟢 React (frontend): RUNNING\n" if react_running else "🔴 React (frontend): OFF\n"
    
    status_label.config(text=status)

def open_report():
    if os.path.exists(LOG_FILE):
        os.startfile(LOG_FILE)
    else:
        status_label.config(text="❌ Log file not found.")

# --- GUI Setup ---
window = tk.Tk()
window.title("Cyberattack Simulator Control Panel")
window.geometry("400x320")
window.resizable(False, False)

tk.Label(window, text="💻 Cyberattack Simulator", font=("Arial", 16, "bold")).pack(pady=10)

tk.Button(window, text="▶️ Start Simulator", command=start_simulator, width=25).pack(pady=5)
tk.Button(window, text="🛑 Stop Simulator", command=stop_simulator, width=25).pack(pady=5)
tk.Button(window, text="🔍 Check Status", command=check_status, width=25).pack(pady=5)
tk.Button(window, text="📄 Open Report", command=open_report, width=25).pack(pady=5)
tk.Button(window, text="🌐 Open Simulator in Browser", command=lambda: webbrowser.open("http://localhost:3000"), width=25).pack(pady=5)

status_label = tk.Label(window, text="", fg="green", justify="left")
status_label.pack(pady=10)

window.mainloop()
